 <!-- index.html ‚Äî VCgs1-Fixed (structure preserved) + Addons -->
<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§µ‡§ø‡§ú‡§ø‡§ü‡§ø‡§Ç‡§ó ‡§ï‡§æ‡§∞‡•ç‡§°</title>
<meta name="theme-color" content="#007bff" />
<link rel="manifest" href="manifest.json">

<!-- üîπ Social Media Preview Tags (Open Graph + Twitter) -->
<meta property="og:title" content="RAMESH CHAND YADAV - Digital Visiting Card">
<meta property="og:description" content="LIC | Mutual Funds | General Insurance - Contact: 9868920766">
<meta property="og:image" content="https://teamrrmoney-bit.github.io/VisitingCard/MyPhoto.jpg">
<meta property="og:url" content="https://teamrrmoney-bit.github.io/VisitingCard/">
<meta property="og:type" content="website">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="RAMESH CHAND YADAV - Digital Visiting Card">
<meta name="twitter:description" content="LIC | Mutual Funds | General Insurance - Click to view details.">
<meta name="twitter:image" content="https://teamrrmoney-bit.github.io/VisitingCard/MyPhoto.jpg">

<style>

  /* Styles preserved from original VCgs1-Fixed */
  body { font-family: Arial, sans-serif; background:#f6f9fc; text-align:center; padding:20px; }
  .card { background:#e9f7ff; border-radius:20px; box-shadow:0 6px 15px rgba(0,0,0,0.15); padding:25px; max-width:480px; margin:auto; border:3px solid #007bff; }
  .header { display:flex; align-items:center; justify-content:center; gap:15px; flex-wrap:wrap; }
  .header img { width:110px; height:110px; border-radius:50%; object-fit:cover; border:2px solid #fff; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
  .header-text { text-align:left; display:flex; flex-direction:column; align-items:flex-start; min-width:200px; }
  .header-text h1 { margin:0; font-size:22px; color:#333; }
  .tags { margin-top:6px; display:flex; gap:8px; font-weight:bold; flex-wrap:wrap; }
  .tags span.lic{ color:#007bff } .tags span.mf{ color:#28a745 } .tags span.gi{ color:#dc3545 }
  .buy-container, .my-container { margin:20px auto; max-width:360px; }
  .arrow-down { display:block; font-size:20px; margin-bottom:8px; animation:bounce 1s infinite alternate; }
  @keyframes bounce { from { transform:translateY(0);} to { transform:translateY(5px); } }
  .buy-box, .my-box { border:2px solid #007bff; border-radius:12px; background:#d6f0ff; padding:15px; display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .buy-box button, .my-box button, .recommend-btn, .mf-btn { padding:12px; font-size:15px; border:none; border-radius:10px; color:white; cursor:pointer; }
  .btn1{background:#007bff;} .btn2{background:#28a745;} .btn3{background:#17a2b8;} .btn4{background:#ffc107;color:black;} .btn5{background:#dc3545;} .btn6{background:#6f42c1;} 
  .btn7{background:#20c997;} .btn8{background:#fd7e14;} 
  .recommend-btn { background:#e83e8c; margin-top:15px; width:90%; }
  .mf-btn, .pay-lic-btn {
  
  /* MF style preserved */
  padding:12px;
  font-size:15px;
  border:none;
  border-radius:10px;
  color:white;
  cursor:pointer;
}

/* ‡§Ö‡§≤‡§ó-‡§Ö‡§≤‡§ó background colors */
.mf-btn { background:#6610f2; }
.pay-lic-btn { background:#007bff; }

  .popup-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.45); display:none; justify-content:center; align-items:center; z-index:9998; }
  .form-popup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:18px; border-radius:14px; box-shadow:0 6px 20px rgba(0,0,0,0.25); z-index:9999; width:92%; max-width:420px; max-height:90vh; overflow:auto; }
  .form-popup h3{ margin-top:0; font-size:18px; }
  .form-popup h4{ margin:10px 0 5px; font-size:15px; }
  .form-popup input, .form-popup select { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; }
  .form-popup button { padding:10px; border-radius:8px; border:none; cursor:pointer; background:#007bff; color:white; }
  .closeBtn { position:absolute; top:10px; right:10px; width:36px; height:36px; border-radius:50%; border:none; background:#f5f5f5; color:#222; font-size:18px; cursor:pointer; box-shadow:0 1px 4px rgba(0,0,0,0.2); z-index:10001; }
  #selectedFileName{ font-size:13px; margin-left:10px; display:inline-block; }
  .message { font-size:14px; color:green; margin-top:5px; display:block; }
  .processing { font-size:14px; color:#ff9800; margin-top:5px; }
  @media(max-width:420px){ .header img{width:80px;height:80px;} .header-text h1{font-size:18px;} .card{max-width:360px;padding:16px;} }
</style>
</head>
<body>

<div class="card">
  <!-- Header -->
  <div class="header">
    <img src="MyPhoto.jpg" alt="‡§Ü‡§™‡§ï‡§æ ‡§´‡•ã‡§ü‡•ã">
    <div class="header-text">
      <h1>RAMESH CHAND YADAV</h1>
      <div class="tags">
        <span class="lic">LIC|</span>
        <span class="mf">Mutual Funds|</span>
        <span class="gi">General Insurance</span>
      </div>
      <p style="margin:5px 0 0 0;font-size:14px;color:#333;line-height:1.6;">
        <a href="tel:9868920766" style="text-decoration:none;color:inherit;">üìû 9868920766</a>
        <a href="https://wa.me/8447983853" target="_blank" style="margin-left:6px;text-decoration:none;">
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" style="height:18px;width:18px;vertical-align:middle;">
        </a><br>
        <a href="mailto:ram111.2008@rediffmail.com" style="text-decoration:none;color:inherit;">‚úâÔ∏è ram111.2008@rediffmail.com</a>
      </p>
      <a href="mycontact.vcf" download style="display:inline-block;margin-top:5px; padding:5px 10px;font-size:13px; background:#28a745;color:white; border-radius:6px;text-decoration:none;">Save Contact</a>
    </div>
  </div>

  <!-- To Buy Buttons (these 6 belong to VC7a sheet) -->
  <div class="buy-container">
    <h3>To Buy Click the button</h3>
    <span class="arrow-down">üëá</span>
    <div class="buy-box">
      <button class="btn1" onclick="openForm('LIC')">LIC</button>
      <button class="btn2" onclick="openForm('Mutual Funds')">Mutual Funds</button>
      <button class="btn3" onclick="openForm('Vehicle Insurance')">Vehicle Insurance</button>
      <button class="btn4" onclick="openForm('Health Insurance')">Health Insurance</button>
      <button class="btn5" onclick="openForm('Travel Insurance')">Travel Insurance</button>
      <button class="btn6" onclick="openForm('PA Policy')">PA Policy</button>
    </div>
  </div>

  <!-- Briefcase -->
  <div class="my-container">
    <h3>Keep all your policies & investments safe ‚Äî use this briefcase üëú üëá</h3>
    <span class="arrow-down">üëá</span>
    <div class="my-box">
      <button class="btn7" onclick="openPdfForm('upload')">Upload PDF</button>
      <button class="btn8" onclick="openPdfForm('view')">View PDF</button>
    </div>
  </div>

<!-- MF Folios + Pay LIC Premium Buttons (Side by Side, like VC7a) -->
<div class="buy-box" style="margin-top:10px;">
  <button class="mf-btn" onclick="openMFForm()">MF Folios</button>
  <button class="pay-lic-btn" onclick="window.open('https://ebiz.licindia.in/D2CPM/?_ga=2.186637225.1458300277.1759801256-903306253.1720361504#DirectPay','_blank')">Pay LIC Premium here</button>
</div>


<!-- Recommend & Earn Button -->
<div style="margin-top:10px; text-align:center;">
  <button class="recommend-btn" onclick="openRecommendForm()">Recommend & Earn</button>
</div>


</div>

<!-- Popups overlay -->
<div class="popup-overlay" id="popupOverlay"></div>

<!-- Upload PDF Popup -->
<div class="form-popup" id="pdfUploadPopup">
  <h3>Upload your PDF</h3>
  <button class="closeBtn" onclick="closeAllPopups()">‚úï</button>
 <form id="pdfUploadForm">
  <label for="pdfCode">4 ‡§°‡§ø‡§ú‡§ø‡§ü ‡§ï‡•ã‡§°</label>
  <input type="text" id="pdfCode" name="code" placeholder="4 ‡§°‡§ø‡§ú‡§ø‡§ü ‡§ï‡•ã‡§°" maxlength="4" required>

  <label for="pdfMobile">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞</label>
  <input type="text" id="pdfMobile" name="mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" required>

  <label for="pdfEmail">‡§à‡§Æ‡•á‡§≤</label>
  <input type="email" id="pdfEmail" name="email" placeholder="‡§à‡§Æ‡•á‡§≤" required>

  <label for="pdfType">PDF Type ‡§ö‡•Å‡§®‡•á‡§Ç</label>
  <select id="pdfType" name="pdfType" required>
    <option value="">PDF Type ‡§ö‡•Å‡§®‡•á‡§Ç</option>
        <option>LIC</option>
      <option>Mutual Funds</option>
      <option>Vehicle Insurance</option>
      <option>Health Insurance</option>
      <option>Travel Insurance</option>
      <option>PA Policy</option>
    </select>
    <input type="file" name="pdfFile" accept="application/pdf" style="display:none;" required>
    <button type="button" id="selectPdfBtnUpload">Select PDF</button>
    <span id="selectedFileName" class="message"></span>
    <button type="submit" style="margin-top:10px;">Upload PDF</button>
  </form>
</div>

<!-- View PDF Popup -->
<div class="form-popup" id="pdfViewPopup">
  <h3>View PDF</h3>
  <button class="closeBtn" onclick="closeAllPopups()">‚úï</button>
  <form id="pdfViewForm">
  <label for="viewCode">4 ‡§°‡§ø‡§ú‡§ø‡§ü ‡§ï‡•ã‡§°</label>
  <input type="text" id="viewCode" name="code" placeholder="4 ‡§°‡§ø‡§ú‡§ø‡§ü ‡§ï‡•ã‡§°" maxlength="4" required>

  <label for="viewContact">Mobile ‡§Ø‡§æ Email</label>
  <input type="text" id="viewContact" name="contact" placeholder="Mobile ‡§Ø‡§æ Email" required>

  <label for="viewPdfType">PDF Type ‡§ö‡•Å‡§®‡•á‡§Ç</label>
  <select id="viewPdfType" name="pdfType" required>
    <option value="">PDF Type ‡§ö‡•Å‡§®‡•á‡§Ç</option>
    <option>LIC</option>
    <option>Mutual Funds</option>
    <option>Vehicle Insurance</option>
    <option>Health Insurance</option>
    <option>Travel Insurance</option>
    <option>PA Policy</option>
  </select>
    <span id="pdfViewMessage" class="message processing"></span>
    <button type="submit" style="margin-top:10px;">View PDF</button>
  </form>
</div>

<!-- MF Folios Popup -->
<div class="form-popup" id="mfPopup">
  <h3>‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡•Å‡§ù‡•á ‡§Æ‡•á‡§∞‡•á Mutual Funds Folios ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡§æ App ‡§¶‡•á‡§®‡•á ‡§ï‡•Ä ‡§ï‡•É‡§™‡§æ ‡§ï‡§∞‡•á‡§Ç</h3>
  <button class="closeBtn" onclick="closeAllPopups()">‚úï</button>
  <form id="mfForm">
  <!-- this will map to VC7C_MF sheet -->
  <input type="hidden" name="formType" value="MF">

  <label for="mfName">‡§®‡§æ‡§Æ</label>
  <input type="text" id="mfName" name="name" placeholder="‡§®‡§æ‡§Æ" required>

  <label for="mfEmail">‡§à‡§Æ‡•á‡§≤</label>
  <input type="email" id="mfEmail" name="email" placeholder="‡§à‡§Æ‡•á‡§≤" required>

  <label for="mfMobile">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Æ‡•ç‡§¨‡§∞</label>
  <input type="text" id="mfMobile" name="mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Æ‡•ç‡§¨‡§∞" required>

  <label for="mfTime">‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§∏‡§Æ‡§Ø</label>
  <select id="mfTime" name="time" required>
    <option value="">‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§∏‡§Æ‡§Ø</option>
    <option>‡§∏‡•Å‡§¨‡§π</option>
    <option>‡§¶‡•ã‡§™‡§π‡§∞</option>
    <option>‡§∂‡§æ‡§Æ</option>
  </select>

  <span class="processing"></span>
  <button type="submit">‡§∏‡§¨‡§Æ‡§ø‡§ü</button>
</form>
</div>

<!-- Recommend & Earn Popup -->
<div class="form-popup" id="recommendPopup">
  <h3>Recommend & Earn Form</h3>
  <button class="closeBtn" onclick="closeAllPopups()">‚úï</button>
  <form id="recommendForm">
  <!-- this will map to VC7D_RECOMMEND sheet -->
  <input type="hidden" name="formType" value="recommend">

  <h4>‡§∞‡§ø‡§ï‡§Æ‡•á‡§Ç‡§° ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø</h4>

  <label for="recName">‡§®‡§æ‡§Æ</label>
  <input type="text" id="recName" name="recommended_name" placeholder="‡§®‡§æ‡§Æ" required>

  <label for="recEmail">‡§à‡§Æ‡•á‡§≤</label>
  <input type="email" id="recEmail" name="recommended_email" placeholder="‡§à‡§Æ‡•á‡§≤" required>

  <label for="recommended_mobile">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Æ‡•ç‡§¨‡§∞</label>
<input type="text" id="recommended_mobile" name="recommended_mobile" placeholder="Enter Mobile No." required>


    <label for="interestSelect">‡§ï‡•ç‡§Ø‡§æ ‡§≤‡•á‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∞‡•Å‡§ö‡§ø ‡§π‡•à?</label>
<select id="interestSelect" name="interest" required>
  <option value="">‡§ï‡•ç‡§Ø‡§æ ‡§≤‡•á‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∞‡•Å‡§ö‡§ø ‡§π‡•à?</option>
  <option value="LIC">LIC</option>
  <option value="MF">Mutual Funds</option>
  <option value="Health">Health Policy</option>
  <option value="Vehicle">Vehicle Policy</option>
</select>
    <h4>‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡§æ</h4>

<label for="yourName">‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
<input type="text" id="yourName" name="your_name" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ" required>

<label for="yourEmail">‡§à‡§Æ‡•á‡§≤</label>
<input type="email" id="yourEmail" name="your_email" placeholder="‡§à‡§Æ‡•á‡§≤" required>

<label for="yourMobile">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Æ‡•ç‡§¨‡§∞</label>
<input type="text" id="yourMobile" name="your_mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Æ‡•ç‡§¨‡§∞" required>

<span id="recommendMessage" class="processing"></span>
<button type="submit">‡§∏‡§¨‡§Æ‡§ø‡§ü</button>
  </form>
</div> 

<script>
/* === IMPORTANT: replace with your deployed Web App URL after deploying Code.gs === */
const GAS_URL = 'https://script.google.com/macros/s/AKfycbxXUM7nCAJwhLQeKvnU7l8iz6Hcm0piEGC9-bvUodJIgsBbo_Ugh7RawfDOhTDthyhbcQ/exec';

const overlay = document.getElementById('popupOverlay');
function showPopup(el){
  overlay.style.display='flex';
  document.querySelectorAll('.form-popup').forEach(p=>p.style.display='none');
  el.style.display='block';
}
function closeAllPopups(){
  overlay.style.display='none';
  document.querySelectorAll('.form-popup').forEach(p=>{
    p.style.display='none';
    const form = p.querySelector('form');
    if(form) form.reset();
    const fname = p.querySelector('#selectedFileName');
    if(fname) fname.innerText = "";
    // Clear all message/processing elements inside this popup (safer)
    p.querySelectorAll('.processing, .message').forEach(m => { m.textContent = ''; });
    // Remove dynamically created forms (from openForm)
    if(p.classList.contains('tempForm')) p.remove();
  });
}
overlay.addEventListener('click', ()=>closeAllPopups());
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeAllPopups(); });

/* === To Buy buttons (these send to VC7a sheet) === */
function openForm(service){
  const box = document.createElement('div');
  box.className='form-popup tempForm'; // <-- added 'tempForm' so closeAllPopups can remove it
  box.innerHTML = `<h3>${service} ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç</h3>
    <button class="closeBtn" onclick="closeAllPopups()">‚úï</button>
    <form class="tempFormInner">
      <!-- formType 'VC7a' ensures these go to VC7a sheet -->
      <input type="hidden" name="formType" value="VC7a">
      <input type="hidden" name="service" value="${service}">
      <input type="text" name="name" placeholder="‡§®‡§æ‡§Æ" required>
      <input type="email" name="email" placeholder="‡§à‡§Æ‡•á‡§≤" required>
      <input type="text" name="mobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤" required>
      <select name="time" required>
        <option value="">‡§ï‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§∏‡§Æ‡§Ø</option>
        <option>‡§∏‡•Å‡§¨‡§π</option><option>‡§¶‡•ã‡§™‡§π‡§∞</option><option>‡§∂‡§æ‡§Æ</option>
      </select>
      <span class="processing"></span>
      <button type="submit">‡§∏‡§¨‡§Æ‡§ø‡§ü</button>
    </form>`;
  document.body.appendChild(box);
  showPopup(box);
  box.querySelector('form').addEventListener('submit', async e=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const msgEl = e.target.querySelector('.processing');
    msgEl.textContent = '‚è≥ Processing... Please wait...';
    try{
      const res = await fetch(GAS_URL,{method:'POST',body:fd});
      const data = await res.json();
      if(data.result === 'success'){ msgEl.textContent = '‚úÖ Form submitted successfully!'; setTimeout(()=>{ closeAllPopups(); box.remove(); },1500); }
      else { msgEl.textContent = 'Error'; }
    } catch(err){
      console.error(err);
      msgEl.textContent = 'Error';
    }
  });
}

/* MF Folios (maps to VC7C_MF) */
function openMFForm(){ showPopup(document.getElementById('mfPopup')); }
document.getElementById('mfForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const fd = new FormData(this);
  // ensure formType value triggers VC7C_MF mapping in server
  fd.set('formType','VC7C_MF');
  const msgEl = this.querySelector('.processing');
  msgEl.textContent = '‚è≥ Processing... Please wait...';
  try {
    const res = await fetch(GAS_URL,{method:'POST',body:fd});
    const data = await res.json();
    if(data.result === 'success'){ msgEl.textContent='‚úÖ Form submitted successfully!'; setTimeout(()=>closeAllPopups(),1500); }
    else { msgEl.textContent='Error'; }
  } catch(err){ console.error(err); msgEl.textContent='Error'; }
});

/* Recommend (maps to VC7D_RECOMMEND) */
function openRecommendForm(){ showPopup(document.getElementById('recommendPopup')); }
document.getElementById('recommendForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const fd = new FormData(this);
  // ensure formType triggers VC7D_RECOMMEND mapping
  fd.set('formType','VC7D_RECOMMEND');
  const msgEl = document.getElementById('recommendMessage');
  msgEl.textContent = '‚è≥ Processing... Please wait...';
  try {
    const res = await fetch(GAS_URL,{method:'POST',body:fd});
    const data = await res.json();
    if(data.result === 'success'){ msgEl.textContent='‚úÖ Form submitted successfully!'; setTimeout(()=>closeAllPopups(),1500); }
    else { msgEl.textContent='Error'; }
  } catch(err){ console.error(err); msgEl.textContent='Error'; }
});

/* Upload PDF: select button shows filename and uploads as base64 (PDF metadata stored in 'PDFs' sheet) */
const selectPdfBtnUpload = document.getElementById('selectPdfBtnUpload');
const pdfInputUpload = document.querySelector('#pdfUploadForm input[name="pdfFile"]');
const selectedFileName = document.getElementById('selectedFileName');

selectPdfBtnUpload.addEventListener('click', ()=> pdfInputUpload.click());
pdfInputUpload.addEventListener('change', ()=>{
  const file = pdfInputUpload.files[0];
  if (file) selectedFileName.textContent = `‚úÖ PDF "${file.name}" selected.`;
  else selectedFileName.textContent = '';
});

document.getElementById('pdfUploadForm').addEventListener('submit', async e => {
  e.preventDefault();
  const form = e.target;
  const submitBtn = form.querySelector('button[type="submit"]');
  const oldText = submitBtn.innerText;
  submitBtn.disabled = true;
  submitBtn.innerText = '‚è≥ Processing... Please wait...';

  const fileInput = form.querySelector('input[name="pdfFile"]');
  const file = fileInput.files[0];
  if(!file) {
    alert('Please select PDF');
    submitBtn.disabled = false;
    submitBtn.innerText = oldText;
    return;
  }
  if(file.size > 10*1024*1024) {
    alert('10 MB max');
    submitBtn.disabled = false;
    submitBtn.innerText = oldText;
    return;
  }

  const reader = new FileReader();
  reader.onload = async () => {
    const base64 = reader.result.split(',')[1];
    const fd = new FormData(form);
    fd.append('base64', base64);
    fd.append('filename', file.name);

    try {
      const res = await fetch(GAS_URL, { method: 'POST', body: fd });
      const data = await res.json();
      if(data.result === 'success') {
        alert('‚úÖ PDF uploaded successfully!');
        closeAllPopups();
      } else {
        alert('Upload failed');
      }
    } catch(err) {
      console.error(err);
      alert('Error: '+err);
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerText = oldText;
    }
  };

  // ‚úÖ File read error handler (added)
  reader.onerror = () => {
    alert('Failed to read file.');
    submitBtn.disabled = false;
    submitBtn.innerText = oldText;
  };

  reader.readAsDataURL(file);
});


/* View PDF: GET action=view -> server returns fileUrl if match */
document.getElementById('pdfViewForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const form = e.target;
  const code = form.querySelector('input[name="code"]').value.trim();
  const contact = form.querySelector('input[name="contact"]').value.trim();
  const pdfType = form.querySelector('select[name="pdfType"]').value;
  const msgEl = document.getElementById('pdfViewMessage');
  msgEl.textContent = '‚è≥ Processing... Please wait...';
  try{
    const res = await fetch(`${GAS_URL}?action=view&code=${encodeURIComponent(code)}&contact=${encodeURIComponent(contact)}&pdfType=${encodeURIComponent(pdfType)}`);
    const data = await res.json();
    if(data.result === 'success' && data.fileUrl){
      const a = document.createElement('a'); a.href = data.fileUrl; a.target = '_blank'; a.rel='noopener'; document.body.appendChild(a); a.click(); a.remove();
      msgEl.textContent = '‚úÖ PDF ready!';
      setTimeout(()=>closeAllPopups(),1500);
    } else {
      msgEl.textContent = 'Code/Contact/Type mismatch!';
      // UX: close popup after a short delay so user doesn't get stuck
      setTimeout(()=>closeAllPopups(),2000);
    }
  } catch(err){
    console.error(err);
    msgEl.textContent = 'Error: '+err;
  }
});

function openPdfForm(mode){
  if(mode === 'upload') showPopup(document.getElementById('pdfUploadPopup'));
  else showPopup(document.getElementById('pdfViewPopup'));
}
</script>

<!-- ‚úÖ Service Worker Registration Script -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
  .then(() => console.log("Service Worker registered"));
}
</script>

</body>
</html>









